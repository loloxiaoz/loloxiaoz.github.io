# 评审标准

## 业务架构

### 业务需求理解

业务目标理解

- 设计文档中必须提供本系统的典型目标客户的分析，包括客户业务目标、业务使用场景
- 设计文档中必须提供目标客户的关键业务用例，该业务用例需要能满足客户的关键业务目标的达成
- 设计文档中必须提供典型的客户网络环境的描述，以及本系统部署位置和环境的描述

业务功能提炼

- 设计文档中必须提供关键业务用例的流程图，并明确标注本系统实现的流程
- 设计文档应提供本系统的关键系统用例，以及系统用例所对应的系统角色，关键系统用例和系统角色应能够满足业务流程和业务用例的完成
- 设计文档中必须提供满足系统用例的业务实体的定义，且业务实体需要能够覆盖业务用例的需求

业务发展研判

- 设计文档中必须提供针对本系统要满足的业务用例以及项目计划进行长期的产品和技术演进的演进路线（蓝图）
- 设计文档中应包含演进路线针对外部环境的现状和未来可能会发生的变化的分析，并有相应的对应方案

### 业务需求分解

架构层次

- 设计文档中必须提供系统关键数据流图
- 设计文档中应给出分层的架构设计，并描述出系统中所有的系统组件和相应关系
- 设计文档中的系统分层结构和不同层之间的交互应合理

功能组件

- 设计文档中应包含针对典型客户环境和系统部署位置而设计的专有的组件
- 设计文档中的关键组件的设计必须通过用例图、对象图、活动图来描述组件的职责、边界、组件内外部交互逻辑和流程
- 设计文档应通过对系统和组件的领域分析建模，分离出系统和组件的核心域、支撑域和通用域，以及领域中的关键对象

模块组织

- 设计文档应通过对象图或鲁棒图来描述清楚组件的边界对象、控制对象、实体对象，以及与其他组件之间的交互接口
- 设计文档应包括组件的关键接口定义，并通过类图表达组件内的关键结构设计
- 设计文档应包括组件的关键数据模型，以及存储方案的设计，并能合理的支持该组件的业务需求、环境需求以及质量需求（DFX）

## 平衡性

### 方案选型

问题背景

- 设计文档必须清晰表述需要进行方案选型的问题的背景和动机，能够明确方案要解决的问题和达成的业务目标
- 问题解决的必要性和收益，是否核心问题
- 寻找的是短期方案 Or 长期方案 Or 永久方案， 方案的目标是什么，要定义什么是成功的方案

竞品分析

- 能够清晰准确地介绍清楚现状
- 能够清晰介绍竞品针对该问题的解决方案的技术架构，优势及缺点
- 相关领域的国外研究情况（如果有涉及），或相关的专利保护情况

### 可行性

- 设计文档对所要达到的目标表述清晰，方案具备实践能力，对短期目标和中长期目标有明确的说明，实现度的描述准确无歧义 
- 方案的可持续性
  - 选用的系统、组件的版本，生命周期，license等是否满足要求
  - 团队的技术栈是什么，与目标技术栈是否匹配
  - 是否选用的现有的CBB组件或者提供可复用组件
  - 移植的开销

### 自主可控

技术和组件的安全性

- 系统、组件没有可被利用的安全漏洞
- 核心功能代码是否自研、可控，代码开源率符合相关要求
- 选取的系统是否精简，对选取系统内的每个文件是做什么用的是否明确

### 性能指标

- 项目要求或评测要求需要达到的性能指标，或者行业的平均性能指标
- 能够给出当前架构的实测数据，或者计算理论性能值
- 对于当前项目的基础版本，能够分析当前的性能瓶颈或者性能开销分布或火焰图

### 核心技术

- 能够讲明白方案是怎么做的，有哪些核心模块，数据如何交互
- 有必要的话，核心模块的关键流程可以给出伪代码
- 核心技术的创新点及专利覆盖度

### 未来规划

- 该技术未来的技术趋势是什么？技术发展方向是什么？
- 技术发展的RoadMap

## 性能

### 容量评估

性能指标定义

- 请求/日志量
- 最大/并发连接数
- 请求响应/数据处理延迟
- 最大用户/终端数量
- 数据存储时长

资源评估

- 资源预估应涵盖性能指标所涉及的所有方面，如基于日志量指标，应至少给出网络带宽以及磁盘存储容量的资源需求预估，避免对可能产生的资源出现评估遗漏；
- 对存在潮汐式资源波动的资源类型（如网络带宽、CPU），应至少给出峰值和均值资源需求评估；
- 资源评估应给出计算公式，并带入性能指标定义进行计算，避免无公式直观评估；

设计文档中应描述业务采用的流控机制及流控处理应急预案（产生有业务影响的流控时的应对策略），在承担超出预期的请求数量的时候依然能保证大部分请求有响应

### 设计策略

瓶颈点识别和性能设计: 设计文档中要根据性能指标定义和资源评估，明确说明潜在的性能瓶颈点，并给出针对性能瓶颈点的技术方案设计

第三方组件选型

- 第三方组件选型应优先选择业内成熟的第三方组件，避免选择不再维护、有明显安全风险或过于小众的第三方组件；
- 第三方组件选型在存在多种可行方案的情况下，应至少针对能力、成熟度、可维护性、性能等几方面进行充分调研和对比，并给出对比报告和选型依据；
- 第三方组件选型过程中，应结合产品实际需求和场景，描述组件部署和使用方式，并进行充分压测给出压测报告；

自行实现组件性能设计

- 应首先阐述为何无法基于业内现有成熟组件而自行实现组件的必要性；
- 若必须引入自行实现组件，应在组件设计文档中完整包括“容量评估”、“设计策略”和“扩展能力”三部分的内容；

竞争力评估: 设计文档需要描述系统在同等数据规模和负载下，资源需求和性能指标与业内竞品的对比和差异分析

### 扩展能力

必要性评估

- 从实际需求和产品规划出发，说明是否需要从架构上考虑性能可扩展性，若不需要扩展（例如防火墙类产品单个防火墙支持指标有明确上限），需要给出充分理由
- 建议从中长期市场需求和业内对应竞品角度思考扩展能力必要性，避免短期赶工暂不考虑但后续版本整体架构大幅调整的情况
- 扩展必要性至少应考虑核心业务模块、组件对各类资源维度的使用情况，阐述业务模块、组件是否会出现对网络资源、计算资源、存储资源等资源的扩展需要

技术设计

- 对于垂直扩展，应阐述为解决性能瓶颈，需要扩展的硬件资源或引入的组件、技术调整
- 对于水平扩展，应详细给出水平扩展涉及的模块和组件，以及相关模块水平扩展相关的设计细节
- 无论何种方式扩展，均应给出扩展前后的性能压测对比，证明扩展的可行性和性价比
- 无论何种方式扩展，均应对扩展过程中的常见问题和解决方案进行阐述（如缓存一致性、Resharding等）

## 可维护性

### 可恢复性

自修复性

- 是否全面描述了系统支持的可自修复能力的场景
- 每个可修复能力的设计是否合理（三个维度：价值、成本和方案）
- 是否包含了可修复性的测试方法

可监控性

- 监控范围是否覆盖全面，比如：系统资源、应用组件、业务服务和数据质量
- 监控结果是否易于体现业务运行状况，并易于指导现场问题排查
- 监控内容是否易于扩展

易分析性

- 是否易于获取分析所需的信息，比如：日志、出问题时的系统数据等
- 是否包含了线上问题定位和修复的流程与工具，比如：远程替包方案

易运维性

- 对于系统运维所需要的流程、方法和工具是否有清晰的定义（比如：定期巡检流程、问题排查流程...）
- 对于系统可能出现的常见问题及应对方式，是否有明确的处理方式（比如知识库）
- 是否包含了预防性的流程、方法和工具，支持现场降低出问题的概率

## 可改进型

易升级性

- 是否说明了系统未来升级时的能力范围、自动化的程度，以及每项提供了合理的实现方案
- 升级方案中是否考虑了失败的应对方式，比如：异常检测、失败回滚等
- 升级方案是否易用到能支持现场运维交付同学独立完成

可兼容性

- 是否符合高内聚低耦合的设计原则（兼容性的基础）
- 版本迭代中是否考虑了不同版本之间接口、数据等的兼容性，并有合理设计

## 可测试性

### 测试设计

可理解性

- 文档标准规范，对模块功能、行为、表现有完整清晰的描述，易于理解，没有歧义
- 文档相对稳定，所有变更有记录，可追踪
- 测试输出和提示信息清晰明确

关注点分离

- 每个模块只解决特定的问题，并且模块之间彼此尽可能隔离，避免不必要的联系
- 模块层次结构合理，业务概念清晰明确

可隔离性

- 待测模块应可以分别隔离测试，不存在较大的互相影响和依赖
- 是否存在测试依赖的外部条件难以获得或成本较高的情况
- 测试框架对此类外部条件Mock的支持难易度和实现成本

### 测试过程

可控制性

- 针对不同测试用例构造测试数据的难易程度
- 将模块状态设置到测试所需状态的难易程度

可观察性

- 待测模块的输入、输出以及行为是否比较容易观察到
- 每个输入有唯一的输出，结果可预期，可以验证，结果差异易于观察
- 系统有必要的日志记录和程序行为监控能力

可追踪性

- 测试过程中操作有正确响应
- 测试过程中状态变化、事件发生可追踪

可自动化性

- 模块可以快速重复测试，人工干预部分可跳过或自动化完成，比如验证码环节
- 连续测试的中间环节有较稳定的输出预期，保证自动化流程运行，多次重复测试时应能输出相同的预期结果

## 可扩展性

### 内部扩展

计算资源扩展能力

- 要体现业务所需计算资源的测量方法
- 要提供业务增长时如何横向扩展计算资源以及完整的实现设计

存储资源扩展能力

- 要体现存储资源和时间的计算方法
- 要提供业务存储数据量增加如何扩充存储节点或者支持增加存储空间等实现方法"

业务扩展能力: 复杂业务扩展是否支持模块扩展和拆分为后续业务扩展提供支持，如用户管理服务、日志接收服务、日志处理服务为独立运行服务

数据扩展能力: 设计文档中应考虑支持根据业务数据设计存储分布和切分，如SaaS化产品的数据根据租户切分方式，如日志类数据是否支持按照时间进行分表或者分片处理等

### 外部扩展

外部接口能力: 设计文档中必须明确说明产品是否支持定制开发，定制开发和扩展是否预留相应API和接口，如系统为公司平台，是否提供平台能力给到业务标准对接能力，提供完整API和管理支持

## 选型

### 范围与过程

选型广度: 设计文档中必须包含对(新增)核心组件/成熟模型进行技术选型说明的章节，覆盖所有的新增关键组件并进行选型对比或说明

可信的决策过程: 在架构设计文档中, 为技术选型决策过程提供了说明, 包含但不限于以下形式:权重加分, 优劣势分析,关键性决策说明

### 整体选型

新项目的架构设计文档中,必须对技术方案整体的架构进行选型说明. 这一选型过程可以不存在对比过程, 但需要具备可信的决策过程

### 组件选型

开源选型: 架构设计文档中, 是否有对方案中使用的开源组件进行选型说明, 主要包括是否官方支持, 社区活跃度, 许可证等

可复用性选型: 技术方案中使用的组件, 是否利用公司内的平台/组件

关键技术选型变更决策

- 是否有给出充分的决策说明
- 是否有提供选型升级与回退的设计

可维护性选型: 已淘汰组件包括: LTS小于1年的项目, 已知安全漏洞的项目

### 其他要素

开发语言选型

- 全新立项项目, 且存在多种可选型语言.例如, 前端开发, 嵌入式开发,机器学习类项目通常不需要进行开发语言选型, 因此这一项的选型以服务端/客户端开发为主
- 新增模块的关键性需求与原开发语言不符.例如, 在一个传统的PHP WEB后端架构中,引入了一个高并发需求模块. 在一个JAVA服务端中, 引入了一个对单次/最高处理时延高度敏感的模块.
- 另外，需要注意所选择语言的主流性，是否便于未来长期维护与投资
- 要求开发语言选型合理, 可满足需求, 且与原开发语言间不存在冲突"

行业标准选型: 架构设计文档中, 是否有对行业标准进行选型的过程. 例如, 权限管理: ACL/RBAC/ABAC, 接口认证: Basic/JWT, 流程标准描述: BPMN/WDL/CWL, 其他如流媒体格式,加密算法等多方面

商业化选型: 技术方案中, 如果引入的商业软件, 是否提供了充足的成本分析.

性能选型: 用于性能敏感的项目, 是否有在可信的决策过程中, 对各备选方案进行性能分析并参考性能分析结论.

## 重用性

### 复用

项目复用: 架构师必须调研公司是否有类似项目已经实现与当前项目类似的功能，并在设计文档中明确说明调研结论

组件复用

- 项目开发的主要组件能否复用公司、部门的已有成果，不能复用的说明原因
- 是否有安全的、高质量的开源解决方案"

逻辑复用: 设计文档中必须要明确说明项目开发的主要算法、模型、业务逻辑，是否有成熟的业内解决方案，重用方案
代码复用: 设计中应对于相同或相近的功能/函数/代码块进行抽象封装，避免在实现阶段出现大段的重复代码

### 贡献

可复用设计: 对新开发的组件要作出评估，能否实现为一个更通用的公共组件，对于可复用的组件，应具备一定的抽象（通用化）设计，适配更多的应用场景并降低复用成本

可复用组件清单:	项目结束前评估能否提炼出可复用的组件，创建清单和计划

文档支持: 提炼出的可复用模块应提供详细的说明文档，包括：适用场景、使用方法、使用限制等

## 专项设计

### 数据库

选型

- 开源数据库或商业数据库
- 单机或集群
- 持久化或非持久化

可用性指标

- 实际所占的磁盘大小[包括数据存储、索引存储、写入日志存储]）
- 内存大小
- 预估访问量大小
- 连接数（明确数据库连接数的上限）

性能指标

- 表结构与类型设计
  - 有无频繁读写表
  - 有无超级大表（1亿+）以及是否使用分区（分区键以及分区的增、删策略）
  - 表字段类型是否用最小原则
  - 数据库保留字使用
  - 是否有一次超过100K以上的请求或者返回
- 索引设计
  - 单张表中索引数量不超过5个
  - 单个索引中的字段数不超过5个
  - 索引名必须全部使用小写
  - 非唯一索引按照idx_字段名称[_字段名称]进用行命名。例如idx_age_name。唯一索引按照uniq_字段名称[_字段名称]进用行命名。例如uniq_age_ne。组合索引建议包含所有字段名,过长的字段名可以采用缩写形式。例如idx_age_name_add
  - 表必须有主键,推荐使用UNSIGNED自增列作为主键
  - 唯一键由3个以下字段组成,并且字段都是整形时,可使用唯一键作为主键。其他情况下,建议使用自增列或发号器作主键
  - 禁止重复索引
  - 原则上不推荐外键（如果需要用，请关注外键涉及字段类型、外键字段所属的SQL）
  - 联表查询时,JOIN列的数据类型必须相同,并且要建立索引
  - 不在低基数列上建立索引,例如“性别”,选择区分度大的列建立索引。组合索引中,区分度大的字段放在最前
- 用户权限
  - 系统数据库用户权限设置要满足数据库用户非root的要求
- 数据增长规模
  - 设计中需要有对归档日志量和表空间增长量的预估，相应的空间配置要合理
- 数据清理策略
  - 明确的数据清理策略
- 安全性
  - 数据库账户、密码
  - 数据库 备份、恢复
分布式数据库
  - 使用得表是否设置合理的分布式键（分片是否均匀）
  - 设计中是否对分布式表join做了合理的考量（一般性能很差）
数据库工具
  - 设计文档中是否考虑了云平台产品部 数据库工具箱 dbup工具 的使用
  - 设计文档中是否考虑了云平台产品部 数据库工具箱 easyPaas工具 的使用

### 日志文件规范

- 日志文件内容
  - 产品的系统日志文件应至少包括业务功能日志文件、系统日志文件和可选的数据（批）处理日志文件，三个日志文件必须独立
  - 业务功能日志文件内容包括：开始时间、请求耗时或交易结束时间（毫秒级）、状态
  - 系统日志文件应至少记录应用程序启动、停止及运行状态的信息
- 日志信息分级输出
  - 日志信息应能够分级输出
- 日志分级变更实时性
  - 日志分级变更能够实时生效，不需要重启服务
- 日志文件量单日大小
  - 日志文件单日增长大小和文件系统设计符合要求，日志轮转策略可配置，无需重启服务
- 日志目录设计
  - 可在目录下按日期、交易或功能等创建子目录
  - 项目组提供应用系统日志文件目录设计方案
- 日志文件命名
  - 日志文件命名符合规范
  - 日志文件名称按照交易码或服务名+时间进行记录，时间至少到日
- 日志文件大小
  - 单个日志文件大小限制可联机动态配置
  - 日志文件单个大小小于500M
  - 可通过文件增加时间序列号等方式对日志文件进行切割，如果大于500M可以进行分割处理
- 日志文件备份策略
  - 日志文件备份策略符合规范要求，业务日志、系统日志与数据（批）处理日志均具备备份策略
- 日志文件清理策略
  - 日志应有归档的设计，日志文件清理策略符合规范要求
  - 核心业务日志文件在专用目录最多保留7天
  - 系统日志文件在专用目录最多保留10天
  - 超过期限须转移至备份目录

### 监控子系统

- 合理的监控指标
  - 利用率（Utilization）
  - 错误（Errors）
  - 和饱和度（Saturation）

- 服务型系统，至少包括以下指标
  - 延迟（Latency/Duration）
  - 流量（Traffic/Rate）
  - 错误（Errors）"

调用链监控, 设计中应对服务调用链进行监控，并使用唯一的请求ID来定位移步请求耗时