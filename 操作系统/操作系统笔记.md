# 操作系统

- 管道的实现是指向同一个临时VFS节点inode的两个file数据结构来实现的， 此VFS指向内存中的一个物理页面
- 命名管道FIFO，总是按照先进先出的原则工作。任何读者进程从FIFO中读取数据之前必须有写着进程向其中写入数据。只能承载无格式字节流，与缓冲区大小受限。以文件形式存在，允许没有亲缘关系的进程间通信
- 套接字进程中的三种通信机制(IPC)，消息队列，共享内存，信号量
- 多个进程可以访问同一块内存，是最快的IPC。是针对其他通信机制运行效率较慢而设计的。 与其他的通讯机制，如信号量结合起来，则可以达到进程间的同步与互斥
6、信号量，主要作为进程间，以及同一进程不同线程间同步的手段。主要用于管理不同进程对资源的访问。 P表示等待，V用于信号。 如果SV的值大于0，则减一，获得信号量。 若SV的值等于0， 则进入等待 
7、套接字。更为一般的进程间通信。 可用在不同机器间的进程通信。

8、linux下的进程包含以下几个关键要素： 1、一段可执行的代码2、有专用的系统堆栈空间3、内核中有他的控制块，描述进程所占用的资源。 进程才愿意接受内核调度。
、具有独立的存储空间。
10、进程和线程是操作系统不同的资源管理方式。 进程有独立的地址空间， 一个进程崩溃后，不会对其他进程产生影响。 线程只是一个进程中不同的执行路径。 线程没有独立的地址空间。一个线程死掉就等于整个进程死掉。 多进程的程序要比多线程的程序健壮。 进程切换时，耗费资源较大。 效率要差。 同时对于一些同时进行但又要共享某些变量的并发操作，只能用线程，不能用进程。 
12、寄存器、cache快速缓存、外存、内存。 
13、存储管理方案分类。 分区存储管理方案、段式存储管理方案、页式存储管理方案、段页式存储管理方案，交互技术与覆盖方案、虚拟存储管理方案。 

16、Linux的IO调度策略。 CFQ(complete fair queuing) 完全公平队列，实现了请求的sort和merge。 每个进程IO请求产生了一个队列。 这个队列对寻道地址进行排序，尽量减少寻道时间。 每个队列有自己的优先级。 然后已时间片轮转的方式去服务每个进程的请求队列。 但是CFQ有个劣势，会存在请求响应时间很长或者被饿死的情况 。 
2、DeadLine 为了解决响应时间太长被饿死的情况，也实现了sort和merge。 然后为每个请求分配一个超期时间。 三种标准队列。 sort queue（按照寻道地址进行排序和合并的请求队列） readqueue （读请求队列）、write queue（写请求队列）。 其中read queue优先级比write queue的优先级高（读会马上等待返回结果）。  Q(read)>Q(write)>Q(deadline) 3NOOP NOOP全称是no operation，简单的FIFO，实现了merge。 当两个请求访问的磁道地址在一起，那么就会合并他们。 使用与SSD、不适应HDD 4AS。 与CFQ差不多，只对离散IO做了优化，但没有对连续的IO做优化。 CFQ是一种通用的方案， DEADLINE是一种响应时间较高的方案，NOOp使用与SSD。
17、(anticipatory)通过等待一段时间来获取更高的性能，将多个随机小写合并成一个大写入流（相当于给随机读写变顺序读写）。使用这个原理来使用读取写入的延时换取最大的读取写入吞吐量。 
18 内存置换算法，
1、fifo  会完成 belady现象(分配的页数越多，缺页率反而提高)
2、最久未被访问算法  lru，开销较大
3、clock页面置换算法，通过access bit来代表时间访问信息， 通过环形链表，遍历access bit为0的，换出，为1的，置为0
19、内存抖动: 频繁的进行页的换入换出
20、全局页面置换算法
1、工作集模型，定量的分析局部性，只保留固定时间段窗口内的页
工作集大小置换算法
缺页率页面置换算法，基于缺页率调整常驻集/工作集，全局算法
21、PCB 进程控制块(Process COntrol Block, PCB)，os为每个进程都维护了一个PCB用来保存与该进程有关的各种状态的信息
1、进程标识信息，本进程标识、父进程标识、用户标识
2、处理机的状态信息保存区 用户可见寄存器、控制和状态寄存器、栈指针
3、进程控制信息， 调度和状态信息，进程间通信信息，存储管理信息，进程所用的资源，有关数据结构连接信息
PCB的组织方式，使用链表（删除和增加比较频繁）
22、进程生命周期
创建、运行、等待、唤醒、结束
进程等待会让出cpu，进程只能自己阻塞自己
进程只能被其他进程或者操作系统唤醒
进程的三个状态： 就绪态、运行态、挂起态
挂起状态：阻塞挂起状态，就绪挂起状态
挂起状态的程序不占用内存，因为被换出到外存
阻塞状态，等待事件到达
23、进程管理
通过状态队列管理进程（就绪队列、挂起队列）
25、线程有独立的寄存器和堆栈
26、进程提供资源平台，进程是资源分配单位，线程是cpus调度单位
27、进程切换需要切换页表，线程切换不需要切换页表。 因此线程切换更加快速，并且线程之间的访问不需要内核
28、完全公平调度，通过计算进程消耗的cpu时间来确定谁来调度。从而达到所谓的公平性。调度器总是选择消耗资源最少的进程来运行。linux采用了一颗红黑树，记录下每一个进程的vruntime，需要调度时，从红黑树中选取一个vruntime最小的进程出来运行
vruntime=
29、当临界区很小的时候，可以选择忙等， 避免让出cpu造成的上下文切换
当临界区很大时，不能选择忙等
30、信号量 p操作和v操作， p操作会阻塞，v操作会唤醒
31、怎么避免死锁，1、避免共享资源，2、避免资源等待与抢占（需要等待资源时，判断是否能立即获取到，如果获取不到，则释放）， 3、避免循环依赖
32、银行家算法，避免死锁。 检查一旦资源分配后，剩余的资源状态是否安全，找到一个安全的资源分配序列
33、银行家算法，死锁检测算法一般不在操作系统中使用，因为1、开销太大，2需要提前知道资源需求情况
34、信号不传递数据，只传递通知，因此很短
35、管道是父子进程之间的传递，而消息队列可以是无关系的进程之间通信
36、共享内存，最快的方式，每个进程地址空间内，明确设置了共享内存段，确定是需要同步数据访问。同一块内存映射到不同的程序地址中
37、文件描述符是一个整数，代表系统中打开文件表中的index
39、日志文件系统：journaling file system 记录文件系统的修改/时间， 当机器掉电时，避免元数据和数据之间的不一致问题
40、虚拟文件系统层： 设备I/O , 网络I/O（nfs,smb)
41、vol （卷控制块）， dentry（目录节点）， inode（文件控制块）
42、raid 1 增加一块磁盘来容错 raid 4配有专用奇偶校验磁盘 raid5 把奇偶校验的块均分分配到5个磁盘中（允许一个块坏掉），raid6允许两个块坏掉。 raid技术既提升访问效率，也提供可靠性
46、sda是第一块SCSI硬盘
