# CDC方案

> CDC 的全称是 Change Data Capture, 主要面向数据库的变更，是一种用于捕获数据库中数据变更的技术

## 使用场景

- 数据同步：用于备份，容灾
- 数据分发：一个数据源分发给多个下游系统
- 数据采集：面向数据仓库 / 数据湖的 ETL 数据集成，是非常重要的数据源

## 实现机制

- 基于查询的 CDC：
  - 离线调度查询作业，批处理，把一张表同步到其他系统，每次通过查询去获取表中最新的数据
  - 无法保障数据一致性，查的过程中有可能数据已经发生了多次变更
  - 不保障实时性，基于离线调度存在天然的延迟
- 基于日志的 CDC：
  - 实时消费日志，流处理，例如 MySQL 的 binlog 日志完整记录了数据库中的变更，可以把 binlog 文件当作流的数据源
  - 保障数据一致性，因为 binlog 文件包含了所有历史变更明细
  - 保障实时性，因为类似 binlog 的日志文件是可以实时消费的，提供的是实时数据

需求

- 能够以实时的方式对接MySQL、Oracle、SQLServer、PostgreSQL等数据源
- 能够在接入的过程中对数据进行轻度转换处理

| 对比项         | Flink CDC                                                      | Debezium                                                       | DataX                                                                                      | Canal  | Sqoop                                        | Kettle                                 |
| -------------- | -------------------------------------------------------------- | -------------------------------------------------------------- | ------------------------------------------------------------------------------------------ | ------ | -------------------------------------------- | -------------------------------------- |
| CDC机制        | 日志                                                           | 日志                                                           | 查询                                                                                       | 日志   | 查询                                         | 查询                                   |
| 数据源         | MySQL、Oracle、SQLServer、PostgreSQL、TiDB、MongoDB、OceanBase | MySQL、Oracle、SQLServer、PostgreSQL、DB2、Cassandra、Vitess等 | MySQL、Oracle、SQLServer、PostgreSQL、Hbase、Phoenix、MongoDB、Hive、HDFS、Elasticsearch等 | MySQL  | MySQL、PostgreSQL、SQLServer、Oracle、Hive等 | MySQL、PostgreSQL、SQLServer、Oracle等 |
| 增量同步       | 支持                                                           | 支持                                                           | 不支持                                                                                     | 支持   | 支持                                         | 不支持                                 |
| 断点续传       | 支持                                                           | 支持                                                           | 不支持                                                                                     | 支持   | 不支持                                       | 不支持                                 |
| 全量同步       | 支持                                                           | 支持                                                           | 支持                                                                                       | 不支持 | 支持                                         | 支持                                   |
| 全量+增量      | 支持                                                           | 支持                                                           | 不支持                                                                                     | 不支持 | 支持                                         | 不支持                                 |
| 架构           | 分布式                                                         | 单机                                                           | 单机                                                                                       | 单机   | 分布式                                       | 分布式                                 |
| Transformation | ★★★★★                                                          | ★★                                                             | ★★                                                                                         | ★★     | ★★                                           | ★                                      |
| 生态           | ★★★★★                                                          | ★★★                                                            | ★★★                                                                                        | ★★★    | ★★                                           | ★★                                     |
| 评分           | ★★★★★                                                          | ★★★                                                            | ★★★                                                                                        | ★★★    | ★★                                           | ★★                                     |

选型的主要考虑点：

- 数据源类型
- 全量和增量的支持
- 转换的支持
- 生态的丰富度