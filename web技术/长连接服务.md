# 长连接服务

## 技术点的考虑

- 连接的创建和维护
- 网络协议的选择
- 使用加密传输
- 验证数据来源等方式保证长连接的安全性
- 通过数据传输格式选择，数据压缩等方式减少数据量，提高传输效率
- 错误异常处理机制

### 协议的选择

TCP为主，同时小流量探索QUIC的潜力

- 建连过程握手耗时长
- 队头阻塞问题

HTTP的队头阻塞:

- http1.1: 一个大的或慢的相应会阻塞后面的其他响应。 存在队头阻塞问题, 单个文件下载完成前，无法再下载其他 需要多路复用解决。 所以一个网页启动6个TCP连接，规避队头阻塞问题。
- http2.0: 在每个块前面放置一个数据帧，每个帧包含了流id以及帧大小。从而允许单个TCP连接上通过交错排列多个块来多路传输多个资源

TCP的队头阻塞：

- 丢失或延迟的数据包2队头阻塞了数据包3, 需要等待数据包2重新传输
- 让传输层独立的传输各种流, 避免队头阻塞问题。即QUIC， 约等于TCP2.0, QUIC在单个资源流中保留了排序

相比HTTP2+TCP+TLS协议，QUIC具有不少优点:

- 减少了TCP三次握手及TLS握手时间
- 改进了拥塞控制
- 没有队头阻塞的多路复用
- 支持连接迁移

### DNS解析优化

使用HTTPDNS替代LocalDNS解析, 优点是

- 绕开了运营商的LocalDNS服务
- 有效防止了域名劫持
- 提高了域名解析效率

### 维护长连接

- 心跳保活
- 断线重连

