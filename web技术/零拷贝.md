# 零拷贝

## Zero Copy

![零拷贝流程](./images/%E9%9B%B6%E6%8B%B7%E8%B4%9D.png)

1、磁盘文件-> pagecache->socket 缓冲->网卡：  3次拷贝、2次上下文切换
2、如果支持DMA，磁盘文件-> pagecache->网卡： 2次拷贝、2次上下文切换

零拷贝使用了pagecache技术， 适合90%以上的场景

大文件场景下不应该使用零拷贝技术，也不应该使用pagecache
高并发场景下，应该使用异步IO和直接IO替换零拷贝技术

## 异步IO

起IO请求后就返回，等内核处理完后通知进程，进程再返回处理， 但不支持pagecache，只支持直接IO

## 直接IO

应用程序绕过page cache，即不经过内核缓冲区、直接访问磁盘的数据，使用场景

- 应用程序实现了磁盘文件的缓存，不需要pagecache再次缓存，比如mysql就使用了直接io
- 高并发传输大文件：大文件难以命中pagecache，又带来额外的拷贝，因此此时会带来直接io

kafka性能高原因就是用了 零拷贝和pagecache

## 最终方案

- 大文件走异步io与直接io
- 小文件走零拷贝与pagecache
